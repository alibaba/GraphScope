g.V().has("COUNTRY", "name", "$country1").in("ISPARTOF").as("city1").in("ISLOCATEDIN").as("p1").both("KNOWS").as("p2").out("ISLOCATEDIN").out("ISPARTOF").has("name", "$country2").select("p1").by(__.in("HASCREATOR").hasLabel("COMMENT").out("REPLYOF").out("HASCREATOR").where(P.eq("p2")).select("p1").dedup().count()).as("case1").select("p1").by(__.in("HASCREATOR").in("REPLYOF").hasLabel("COMMENT").out("HASCREATOR").where(P.eq("p2")).select("p1").dedup().count()).as("case2").select("p1").by(out("LIKES").hasLabel("POST", "COMMENT").out("HASCREATOR").where(P.eq("p2")).select("p1").dedup().count()).as("case3").select("p1").by(__.in("HASCREATOR").hasLabel("POST", "COMMENT").in("LIKES").where(P.eq("p2")).select("p1").dedup().count()).as("case4").select(expr("@case1 * 4 + @case2 * 1 + @case3 * 10 + @case4 * 1")).as("score").order().by(select("score"), desc).by(select("p1").by("id"), asc).by(select("p2").by("id"), asc).dedup("city1").select("p1", "p2", "score").by("id").by("id").by()