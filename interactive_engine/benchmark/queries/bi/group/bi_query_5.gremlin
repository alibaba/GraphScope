g.V().has("TAG", "name", "$tag").in("HASTAG").as("msg") .out("HASCREATOR").as("person") .union( select("msg").as("msg1"), select("msg").in("LIKES").as("like"), select("msg").in("REPLYOF").as("reply")) .group() .by(select("person")) .by( select("msg1").count().as("msgCnt"), select("like").count().as("likeCnt"), select("reply").count().as("replyCnt")) .select(keys).as("person") .select(expr("1*@msgCnt+2*@replyCnt+10*@likeCnt")).as("score") .order() .by(select("score"), desc) .by(select("person").by("id"), asc) .limit(100) .select("person", "replyCnt", "likeCnt", "msgCnt", "score") .by("id").by().by().by().by()