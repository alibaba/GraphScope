<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Negative Sampling &mdash; GraphScope  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

 

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4TMYCGJ0X2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-4TMYCGJ0X2');
</script>

<script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?da649ade2298891886e31922dfc8870f";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script>


</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> GraphScope
          </a>
              <div class="version">
                latest
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div>
  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      
      
        
          
        
      
      
        <p class="caption"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deployment.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../loading_graph.html">Loading Graphs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../graph_transformation.html">Graph Transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analytics_engine.html">GraphScope Analytical Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../interactive_engine.html">GraphScope Interactive Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../learning_engine.html">GraphScope Learning Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../persistent_graph_store.html">Persistent Graph Store</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../frequently_asked_questions.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer_guide.html">Developer Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../python_index.html">Python API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analytical_engine_index.html">Analytical Engine API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gae_java/index.html">Analytical Engine Java API Reference</a></li>
</ul>

      
    
  </div>

      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">GraphScope</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Negative Sampling</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/alibaba/graphscope/edit/main/docs/reference/gnn_engine/negative_sampling_en.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="negative-sampling">
<h1>Negative Sampling<a class="headerlink" href="#negative-sampling" title="Permalink to this headline"></a></h1>
<p># 1 Introduction As an important method of unsupervised training,
negative sampling refers to sample the vertices that have no direct edge
connected the given vertex. Similar to neighbor sampling, negative
sampling also has different sampling strategies, such as random sampling
and sampling by in-degree of input vertex. As a common operator of GNN,
negative sampling supports expansion and scene-oriented customization.</p>
<p># 2 Usage ## 2.1 Interface The input of the negative sampling operator
can be an edge or vertex type. When the input is an edge type, the
operator refers to “under certain edge type, sample vertices that are
not directly connected to a given vertex, from a candidate vertices
set”. The candidate vertices set contains all vertices that are
connected by the certain edge type and are not connected to the given
vertex.</p>
<p>When the input is a vertex type, the operator refers to “sample vertices
of a certain type that are not directly connected to a given vertex,
from a candidate vertices set”. Here, the user needs to specify the
candidate vertex set to sample from. The sampling results are organized
into <code class="docutils literal notranslate"><span class="pre">Nodes</span></code> objects (similar to 1-hop neighbor sampling, but there is
no <code class="docutils literal notranslate"><span class="pre">Edges</span></code> object).</p>
<p>A negative sampling operation can be divided into the following three
steps: - Define the negative sampling oprator by calling
<code class="docutils literal notranslate"><span class="pre">g.negative_sampler()</span></code> to get the <code class="docutils literal notranslate"><span class="pre">NegativeSampler</span></code> object <code class="docutils literal notranslate"><span class="pre">S</span></code>; -
Invoke <code class="docutils literal notranslate"><span class="pre">S.get(ids)</span></code> to get the <code class="docutils literal notranslate"><span class="pre">Nodes</span></code> object; - Invoke the
<a class="reference external" href="graph_query_cn.md#FPU74">interface</a> of <code class="docutils literal notranslate"><span class="pre">Nodes</span></code> object to get
specific values.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">negative_sampler</span><span class="p">(</span><span class="n">object_type</span><span class="p">,</span> <span class="n">expand_factor</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">):</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Args:</span>
<span class="sd">  object_type(string): Edge type or vertex type</span>
<span class="sd">  expand_factor(int):  Number of random samples</span>
<span class="sd">  strategy(string):    Sampling strategy, see below for detailed description.</span>
<span class="sd">Return:</span>
<span class="sd">  NegativeSampler object.</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">NegativeSampler</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="sd">&quot;&quot;&quot; Negative sampling on given vertices ids.</span>
<span class="sd">Args:</span>
<span class="sd">  ids(numpy.ndarray): 1-d int64 array</span>
<span class="sd">  **kwargs: Extended parameters, different sampling strategies may require different parameters</span>
<span class="sd">Return:</span>
<span class="sd">  Nodes object.</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>## 2.2 Example</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">es</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">edge_sampler</span><span class="p">(</span><span class="s2">&quot;buy&quot;</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">)</span>
<span class="n">ns</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">negative_sampler</span><span class="p">(</span><span class="s2">&quot;buy&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">es</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="n">neg_nodes</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">edges</span><span class="o">.</span><span class="n">src_ids</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">neg_nodes</span><span class="o">.</span><span class="n">ids</span><span class="p">)</span>          <span class="c1"># shape is (3, 5)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">neg_nodes</span><span class="o">.</span><span class="n">int_attrs</span><span class="p">)</span>    <span class="c1"># shape is (3, 5, count(int_attrs))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">neg_nodes</span><span class="o">.</span><span class="n">float_attrs</span><span class="p">)</span>  <span class="c1"># shape is (3, 5, count(float_attrs))</span>
</pre></div>
</div>
<p>In GSL, the main operations of negative sampling are <code class="docutils literal notranslate"><span class="pre">outNeg()</span></code> /
<code class="docutils literal notranslate"><span class="pre">inNeg()</span></code> / <code class="docutils literal notranslate"><span class="pre">Neg()</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Negative sampling 1-hop neighbor vertices</span>
<span class="n">g</span><span class="o">.</span><span class="n">V</span><span class="p">()</span><span class="o">.</span><span class="n">outNeg</span><span class="p">(</span><span class="n">edge_type</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">by</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span>

<span class="c1"># 2. Negative sampling 2-hop neighbor vertices</span>
<span class="n">g</span><span class="o">.</span><span class="n">V</span><span class="p">()</span><span class="o">.</span><span class="n">outNeg</span><span class="p">(</span><span class="n">edge_type</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">by</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span><span class="o">.</span><span class="n">outNeg</span><span class="p">(</span><span class="n">edge_type</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">by</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span>

<span class="c1"># 3. Negative sampling on given candidate vertex set</span>
<span class="n">g</span><span class="o">.</span><span class="n">V</span><span class="p">()</span><span class="o">.</span><span class="n">Neg</span><span class="p">(</span><span class="n">node_type</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">by</span><span class="p">(</span><span class="s2">&quot;node_weight&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p># 3 Negative Sampling Strategies GL currently supports the following
negative sampling strategies. They are also possible values of the
<code class="docutils literal notranslate"><span class="pre">strategy</span></code> parameter when creating the <code class="docutils literal notranslate"><span class="pre">NegativeSampler</span></code> object.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>strategy</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>random</p></td>
<td><p>Random negative sampling,
true-negative is not guaranteed</p></td>
</tr>
<tr class="row-odd"><td><p>in_degree</p></td>
<td><p>Negative sampling with vertex
in-degree distribution as
probability, true-negative is
guaranteed</p></td>
</tr>
<tr class="row-even"><td><p>node_weight</p></td>
<td><p>Negative sampling with vertex
weight as probability,
true-negative is guaranteed</p></td>
</tr>
</tbody>
</table>
</div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2023, DAMO Academy, Alibaba Inc..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          

            
              
                <dd><a href="../../../latest/index.html">latest</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../index.html">stable</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.17.0/index.html">v0.17.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.16.0/index.html">v0.16.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.15.0/index.html">v0.15.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.14.0/index.html">v0.14.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.13.0/index.html">v0.13.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.12.0/index.html">v0.12.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.11.0/index.html">v0.11.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.10.1/index.html">v0.10.1</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.10.0/index.html">v0.10.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.9.1/index.html">v0.9.1</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.9.0/index.html">v0.9.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.8.0/index.html">v0.8.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.7.0/index.html">v0.7.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.6.1/index.html">v0.6.1</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.6.0/index.html">v0.6.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.5.0/index.html">v0.5.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.4.1/index.html">v0.4.1</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.4.0/index.html">v0.4.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.3.0/index.html">v0.3.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.2.1/index.html">v0.2.1</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.2.0/index.html">v0.2.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.1.3/index.html">v0.1.3</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.1.2/index.html">v0.1.2</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.1.1/index.html">v0.1.1</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.1.0/index.html">v0.1.0</a></dd>
              
            

          
        
      </dl>
    </div>
  </div>

  <div class="rst-languages shift-up" role="note" aria-label="languages">
    <div class="rst-other-languages">
      <dl>
        <dt>Languages</dt>
        <dd><a href="../../index.html">en</a></dd>
        <dd><a href="../../zh/index.html">zh_CN</a></dd>
      </dl>

      <hr />
      <small>
        <span>Hosted by <a href="https://pages.github.com/">Github Pages</a>.</span>
      </small>
    </div>
  </div>


</body>
</html>