<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Data Source &mdash; GraphScope  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

 

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4TMYCGJ0X2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-4TMYCGJ0X2');
</script>

<script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?da649ade2298891886e31922dfc8870f";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script>


</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> GraphScope
          </a>
              <div class="version">
                latest
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div>
  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      
      
        
          
        
      
      
        <p class="caption"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deployment.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../loading_graph.html">Loading Graphs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../graph_transformation.html">Graph Transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analytics_engine.html">GraphScope Analytical Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../interactive_engine.html">GraphScope Interactive Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../learning_engine.html">GraphScope Learning Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../persistent_graph_store.html">Persistent Graph Store</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../frequently_asked_questions.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer_guide.html">Developer Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../python_index.html">Python API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analytical_engine_index.html">Analytical Engine API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gae_java/index.html">Analytical Engine Java API Reference</a></li>
</ul>

      
    
  </div>

      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">GraphScope</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Data Source</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/alibaba/graphscope/edit/main/docs/reference/gnn_engine/data_loader_en.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="data-source">
<h1>Data Source<a class="headerlink" href="#data-source" title="Permalink to this headline"></a></h1>
<p>This document is used to explain the data format supported by GraphLearn
and the API to describe and parse it.</p>
</div>
<div class="section" id="data-format">
<h1>1 Data format<a class="headerlink" href="#data-format" title="Permalink to this headline"></a></h1>
<p>Graph data can be divided into <strong>vertex data</strong> and <strong>edge data</strong>.
Generally, vertex data contains <strong>vertex ID</strong> and <strong>attribute</strong>,
describing an entity. Edge data contains <strong>source vertex ID</strong> and
<strong>destination vertex ID</strong>, describing the relationship between vertices.
In heterogeneous graph settings, there are multiple types of vertices
and edges. Therefore, we need the type of information of vertices and
edges to distinguish different types. Type information is described
through APIs. Both vertices and edges have attributes. For example, in
“a user bought a certain product on Saturday morning”, the time
information “Saturday morning” is an edge attribute. Also, in many
scenarios, users need the concept of “weight”—vertex weight or edge
weight, as a measure of importance, such as “sample neighbor nodes by
weight”. The sources of “weight” are diverse, varying from task to task.
In supervised learning classification tasks, vertices or edges may also
have labels. We abstract the data formats of these typical settings as
<strong>ATTRIBUTED</strong>, <strong>WEIGHTED, and LABELED</strong>, which are used to represent
vertex or edge containing attributes, weights, and labels. For vertex
data sources and edge data sources, these three can co-exist or
partially exist at the same time.</p>
<div class="section" id="basic-format">
<h2>1.1 Basic format<a class="headerlink" href="#basic-format" title="Permalink to this headline"></a></h2>
<p>The basic vertex data only contains the ID of a vertex. The type of ID
is bigint and each ID uniquely represents one vertex. However, in many
cases vertices with only IDs are far from enough. Therefore, they can
also contain attributes, weights or labels. The basic edge data only
contains the source vertex ID and the destination vertex ID. The ID type
of edge is also bigint and each ID uniquely represents one edge and the
relationship between two vertices. The schema of the basic edge data
source is shown below. The basic edge data format can be used
independently, without attaching attributes, weights, and labels.</p>
<p>The schema of the basic edge data format:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 26%" />
<col style="width: 39%" />
<col style="width: 35%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>source</p></th>
<th class="head"><p>data type</p></th>
<th class="head"><p>comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>src_id</p></td>
<td><p>BIGINT</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>dst_id</p></td>
<td><p>BIGINT</p></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="attribute-format-attributed">
<h2>1.2 Attribute format（ATTRIBUTED）<a class="headerlink" href="#attribute-format-attributed" title="Permalink to this headline"></a></h2>
<p>The attribute format is used to express the attribute information of a
vertex or an edge. In general, vertices have attributes by default
(otherwise only the edge table is sufficient). The attribute has only
one column, which is of string type. Multiple attributes can be divided
by custom separators inside the string. For example, if there are 3
attributes of a vertex, namely <code class="docutils literal notranslate"><span class="pre">shanghai,</span> <span class="pre">10,</span> <span class="pre">0.01</span></code> separated by the
separator ‘:’, the attribute data corresponding to the vertex is
<code class="docutils literal notranslate"><span class="pre">shanghai:10:0.01</span></code>. When the data format has attributes regardless of
whether it is vertex data or edge data, it is necessary to display and
specify <strong>ATTRIBUTED</strong> to inform the system in the API description.</p>
<p>The schema of the vertex data attribute format:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 37%" />
<col style="width: 33%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>source</p></th>
<th class="head"><p>data type</p></th>
<th class="head"><p>comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>id</p></td>
<td><p>BIGINT</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>attributes</p></td>
<td><p>STRING</p></td>
<td></td>
</tr>
</tbody>
</table>
<p>The schema of the edge data attribute format:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 37%" />
<col style="width: 33%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>source</p></th>
<th class="head"><p>data type</p></th>
<th class="head"><p>comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>src_id</p></td>
<td><p>BIGINT</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>dst_id</p></td>
<td><p>BIGINT</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>attributes</p></td>
<td><p>STRING</p></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="weight-format-weighted">
<h2>1.3 Weight format（WEIGHTED）<a class="headerlink" href="#weight-format-weighted" title="Permalink to this headline"></a></h2>
<p>The weight format is used to express a vertex or an edge with weight.
Similar to attributes, the weight has only one column, which is of type
<strong>float</strong>. When the data format has weights, it is necessary to display
the specified <strong>WEIGHTED</strong> to inform the system, in the API description.</p>
<p>The schema of the vertex data weight format:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 37%" />
<col style="width: 33%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>source</p></th>
<th class="head"><p>data type</p></th>
<th class="head"><p>comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>id</p></td>
<td><p>BIGINT</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>attributes</p></td>
<td><p>FLOAT</p></td>
<td></td>
</tr>
</tbody>
</table>
<p>The schema of the edge data weight format:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 26%" />
<col style="width: 39%" />
<col style="width: 35%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>source</p></th>
<th class="head"><p>data type</p></th>
<th class="head"><p>comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>src_id</p></td>
<td><p>BIGINT</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>dst_id</p></td>
<td><p>BIGINT</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>weight</p></td>
<td><p>FLOAT</p></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="label-format-labeled">
<h2>1.4 Label format（LABELED）<a class="headerlink" href="#label-format-labeled" title="Permalink to this headline"></a></h2>
<p>The label format is used to express the situation where the vertices or
edges are labeled. The label has only one column, which is of type int.
When the data format has labels, it is necessary to display and specify
<strong>LABELD</strong> to inform the system, in the API description.</p>
<p>The schema of the vertex data label format:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 26%" />
<col style="width: 39%" />
<col style="width: 35%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>source</p></th>
<th class="head"><p>data type</p></th>
<th class="head"><p>comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>id</p></td>
<td><p>BIGINT</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>label</p></td>
<td><p>INT</p></td>
<td></td>
</tr>
</tbody>
</table>
<p>The schema of the edge data weight format:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 26%" />
<col style="width: 39%" />
<col style="width: 35%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>source</p></th>
<th class="head"><p>data type</p></th>
<th class="head"><p>comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>src_id</p></td>
<td><p>BIGINT</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>dst_id</p></td>
<td><p>BIGINT</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>label</p></td>
<td><p>INT</p></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="putting-together">
<h2>1.5 Putting together<a class="headerlink" href="#putting-together" title="Permalink to this headline"></a></h2>
<p>ID is required for the vertex and edge data source, while weight, label,
and attribute are optional information. When there are one or more of
<strong>WEIGHTED, ATTRIBUTED, and LABELED</strong> at the same time in the data
source, the combination format of mandatory and optional information
needs to follow a certain order. 1）The order of the format schema for
<strong>vertex data source</strong> is shown as follow.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 26%" />
<col style="width: 23%" />
<col style="width: 51%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>source</p></th>
<th class="head"><p>data type</p></th>
<th class="head"><p>comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>id</p></td>
<td><p>BIGINT</p></td>
<td><p>mandatory</p></td>
</tr>
<tr class="row-odd"><td><p>weight</p></td>
<td><p>FLOAT</p></td>
<td><p>optional: WEIGHTED</p></td>
</tr>
<tr class="row-even"><td><p>label</p></td>
<td><p>BIGINT</p></td>
<td><p>optional: LABELED</p></td>
</tr>
<tr class="row-odd"><td><p>attributes</p></td>
<td><p>STRING</p></td>
<td><p>optional: ATTRIBUTED</p></td>
</tr>
</tbody>
</table>
<p>2）The order of the format schema for <strong>edge data source</strong> is shown as
follow</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 26%" />
<col style="width: 23%" />
<col style="width: 51%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>source</p></th>
<th class="head"><p>data type</p></th>
<th class="head"><p>comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>src_id</p></td>
<td><p>BIGINT</p></td>
<td><p>mandatory</p></td>
</tr>
<tr class="row-odd"><td><p>dst_id</p></td>
<td><p>BIGINT</p></td>
<td><p>mandatory</p></td>
</tr>
<tr class="row-even"><td><p>weight</p></td>
<td><p>FLOAT</p></td>
<td><p>optional: WEIGHTED</p></td>
</tr>
<tr class="row-odd"><td><p>label</p></td>
<td><p>BIGINT</p></td>
<td><p>optional: LABELED</p></td>
</tr>
<tr class="row-even"><td><p>attributes</p></td>
<td><p>STRING</p></td>
<td><p>optional: ATTRIBUTED</p></td>
</tr>
</tbody>
</table>
<p>We can choose zero or some optional information but must <strong>guarantee the
orders</strong> as specified in the above tables.</p>
</div>
</div>
<div class="section" id="data-source-type">
<h1>2 Data source type<a class="headerlink" href="#data-source-type" title="Permalink to this headline"></a></h1>
<p>The system abstracts the data access layer to allow easy connection to
multiple types of data sources. Currently, it supports LocalFileSystem.
If it is used on the Alibaba Cloud PAI platform, you can directly read
MaxCompute data tables. The data is represented as a two-dimensional
structure, the row represents a vertex or an edge data, and the column
represents a certain dimension of information of the vertex or edge.</p>
<p>## 2.1 Local FileSystem In the local file, the data types are specified
as follows, where the column name is not required. It supports reading
data from one or more local files to facilitate local debugging process.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 57%" />
<col style="width: 43%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>column</p></th>
<th class="head"><p>type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>id</p></td>
<td><p>int64</p></td>
</tr>
<tr class="row-odd"><td><p>weight</p></td>
<td><p>float</p></td>
</tr>
<tr class="row-even"><td><p>label</p></td>
<td><p>int32</p></td>
</tr>
<tr class="row-odd"><td><p>features</p></td>
<td><p>string</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>Vertex file format is defined as follow, where the first line is the</p></li>
</ul>
<p>column name indicating the required information or extended information,
separated by <strong>tabs</strong>, and each row element is “column name: data type”.
Each remaining row of data represents the information of a vertex,
corresponding to the information name in the first column, separated by
<strong>tab</strong>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># file://node_table</span>
<span class="nb">id</span><span class="p">:</span><span class="n">int64</span>  <span class="n">feature</span><span class="p">:</span><span class="n">string</span>
<span class="mi">0</span> <span class="n">shanghai</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="n">s2</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mf">0.1</span><span class="p">:</span><span class="mf">0.5</span>
<span class="mi">1</span> <span class="n">beijing</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="n">s2</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mf">0.1</span><span class="p">:</span><span class="mf">0.5</span>
<span class="mi">2</span> <span class="n">hangzhou</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="n">s2</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mf">0.1</span><span class="p">:</span><span class="mf">0.5</span>
<span class="mi">3</span> <span class="n">shanghai</span><span class="p">:</span><span class="mi">3</span><span class="p">:</span><span class="n">s2</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mf">0.1</span><span class="p">:</span><span class="mf">0.5</span>
</pre></div>
</div>
<p>2）Edge file format is defined as follow, where the first line is the
column name indicating the required information or extended information,
separated by <strong>tabs</strong>, and each element is “column name: data type”.
Each remaining row of data represents the information of an edge,
corresponding to the information name in the first column, separated by
<strong>tab</strong>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># file://edge_table</span>
<span class="n">src_id</span><span class="p">:</span><span class="n">int64</span>  <span class="n">dst_id</span><span class="p">:</span><span class="n">int64</span>  <span class="n">weight</span><span class="p">:</span><span class="nb">float</span>  <span class="n">feature</span><span class="p">:</span><span class="n">string</span>
<span class="mi">0</span> <span class="mi">5</span> <span class="mf">0.215340</span>  <span class="n">red</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="n">s2</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mf">0.1</span><span class="p">:</span><span class="mf">0.5</span>
<span class="mi">0</span> <span class="mi">7</span> <span class="mf">0.933091</span>  <span class="n">grey</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="n">s2</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mf">0.1</span><span class="p">:</span><span class="mf">0.5</span>
<span class="mi">0</span> <span class="mi">1</span> <span class="mf">0.362519</span>  <span class="n">blue</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="n">s2</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mf">0.1</span><span class="p">:</span><span class="mf">0.5</span>
<span class="mi">0</span> <span class="mi">9</span> <span class="mf">0.097545</span>  <span class="n">yellow</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="n">s2</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mf">0.1</span><span class="p">:</span><span class="mf">0.5</span>
</pre></div>
</div>
<p>By using local files as data sources, you can directly use file paths in
scripts. See the next chapter “<a class="reference external" href="graph_object_cn.md">graph object</a>”
for details.</p>
<div class="section" id="alibaba-cloud-maxcompute-data-table">
<h2>2.2 Alibaba Cloud MaxCompute data table<a class="headerlink" href="#alibaba-cloud-maxcompute-data-table" title="Permalink to this headline"></a></h2>
<p>The data format of MaxCompute data table is described as follow, where
column name is not required.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 57%" />
<col style="width: 43%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>column</p></th>
<th class="head"><p>type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>id</p></td>
<td><p>BIGINT</p></td>
</tr>
<tr class="row-odd"><td><p>weight</p></td>
<td><p>FLOAT</p></td>
</tr>
<tr class="row-even"><td><p>label</p></td>
<td><p>BIGINT</p></td>
</tr>
<tr class="row-odd"><td><p>features</p></td>
<td><p>STRING</p></td>
</tr>
</tbody>
</table>
<p>To use MaxCompute as a data source, the following two steps are
required:1) Submit a GL Job through the PAI command, and use the
MaxCompute table as the input of the <code class="docutils literal notranslate"><span class="pre">tables</span></code> parameter. Multiple
tables are separated by commas.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pai</span> <span class="o">-</span><span class="n">name</span> <span class="n">graphlearn</span>
<span class="o">-</span><span class="n">Dscript</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
<span class="o">-</span><span class="n">DentryFile</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
<span class="o">-</span><span class="n">Dtables</span><span class="o">=</span><span class="s2">&quot;odps://prj/tables/node_table,odps://prj/tables/edge_table&quot;</span>
<span class="o">...</span><span class="p">;</span>
</pre></div>
</div>
<p>2） In the script, the MaxCompute table parameters are obtained through
FLAG of TensorFlow in order to obtain the data source. The data source
can be one or more.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">graphlearn</span> <span class="k">as</span> <span class="nn">gl</span>

<span class="n">flags</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">flags</span>
<span class="n">FLAGS</span> <span class="o">=</span> <span class="n">flags</span><span class="o">.</span><span class="n">FLAGS</span>
<span class="n">flags</span><span class="o">.</span><span class="n">DEFINE_string</span><span class="p">(</span><span class="s2">&quot;tables&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;odps table name&quot;</span><span class="p">)</span>
<span class="n">node_source</span><span class="p">,</span> <span class="n">edge_source</span> <span class="o">=</span> <span class="n">FLAGS</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="user-api">
<h1>3 User API<a class="headerlink" href="#user-api" title="Permalink to this headline"></a></h1>
<p>## 3.1 Decoder type <code class="docutils literal notranslate"><span class="pre">Decoder</span></code> type is used to described the
aforementioned data format as follows.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Decoder</span><span class="p">(</span><span class="n">weighted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labeled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">attr_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attr_delimiter</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">weighted:       Describe whether the data source is weighted, the default is False</span>
<span class="sd">labeled:        Describe whether the data source has a label, the default is False</span>
<span class="sd">attr_types:     When the data source has attributes, the parameter is a string list,</span>
<span class="sd">                describing the type of each attribute.</span>
<span class="sd">                Each element in the list only supports &quot;string&quot;, &quot;int&quot; and &quot;float&quot; types.</span>
<span class="sd">                The parameter format is like [&quot;string&quot;, &quot;int&quot;, &quot;float&quot;], representing the data contains 3 attributes,</span>
<span class="sd">                In order, they are string type, int type, float type.</span>
<span class="sd">                The default is None, that is, the data source has no attributes.</span>
<span class="sd">attr_delimiter: When the data has attributes (compressed into a large string), you need to</span>
<span class="sd">                know how to parse it. This parameter describes the separator between each attribute.</span>
<span class="sd">                For example, &quot;shanghai:0:0.1&quot;, the separator is &quot;:&quot;. The default is&quot;:&quot;.</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Considering the combination with neural network, string type attributes
are more difficult to handle. The common practice is to first map string
to int through hash, and then encode int into embedding. For this
reason, GL has made a special extension to the attributes of the string
type, that is, it supports converting string to int during the
initialization phase of graph data. At this time, the “string” in the
attr_types parameter needs to be changed to the tuple type
<code class="docutils literal notranslate"><span class="pre">(&quot;string&quot;,</span> <span class="pre">bucket_size)</span></code>, and bucket_size represents the size of the
int space to be converted. When conversion is done, the subsequent
visits will be unified as int-typed attributes. In addition to
simplifying subsequent operations, this conversion will greatly reduce
memory overhead.</p>
<p>## 3.2 Vertex decoder Vertex decoder can take the following formats.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">graphlearn</span> <span class="k">as</span> <span class="nn">gl</span>

<span class="c1"># schema = (src_id int64, dst_id int64, weight double)</span>
<span class="n">gl</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">weighted</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># schema = (src_id int64, dst_id int64, label int32)</span>
<span class="n">gl</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">labeled</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># schema = (src_id int64, dst_id int64, attributes string)</span>
<span class="n">gl</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">attr_type</span><span class="o">=</span><span class="p">{</span><span class="n">your_attr_types</span><span class="p">},</span> <span class="n">attr_delimiter</span><span class="o">=</span><span class="p">{</span><span class="n">you_delimiter</span><span class="p">})</span>

<span class="c1"># schema = (src_id int64, dst_id int64, weight float, attributes string)</span>
<span class="n">ag</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">weightd</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">attr_type</span><span class="o">=</span><span class="p">{</span><span class="n">your_attr_types</span><span class="p">},</span> <span class="n">attr_delimiter</span><span class="o">=</span><span class="p">{</span><span class="n">you_delimiter</span><span class="p">})</span>

<span class="c1"># schema = (src_id int64, dst_id int64, weight float, label int32)</span>
<span class="n">gl</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">weighted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">labeled</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># schema = (src_id int64, dst_id int64, label int32, attributes string)</span>
<span class="n">gl</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">labeled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">attr_type</span><span class="o">=</span><span class="p">{</span><span class="n">your_attr_types</span><span class="p">},</span> <span class="n">attr_delimiter</span><span class="o">=</span><span class="p">{</span><span class="n">you_delimiter</span><span class="p">})</span>

<span class="c1"># schema = (src_id int64, dst_id int64, weight float, label int32 attributes string)</span>
<span class="n">gl</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">weighted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">labeled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">attr_type</span><span class="o">=</span><span class="p">{</span><span class="n">your_attr_types</span><span class="p">},</span> <span class="n">attr_delimiter</span><span class="o">=</span><span class="p">{</span><span class="n">you_delimiter</span><span class="p">})</span>
</pre></div>
</div>
<p>## 3.3 Edge decoder Edge decoder can take the following formats.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">graphlearn</span> <span class="k">as</span> <span class="nn">gl</span>

<span class="c1"># schema = (scr_id int64, dst_id int64)</span>
<span class="n">gl</span><span class="o">.</span><span class="n">Decoder</span><span class="p">()</span>

<span class="c1"># schema = (src_id int64, dst_id int64, weight float)</span>
<span class="n">gl</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">weighted</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># schema = (src_id int64, dst_id int64, label int32)</span>
<span class="n">gl</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">labeled</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># schema = (src_id int64, dst_id int64, attributes string)</span>
<span class="n">gl</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">attr_type</span><span class="o">=</span><span class="p">{</span><span class="n">your_attr_types</span><span class="p">},</span> <span class="n">attr_delimiter</span><span class="o">=</span><span class="p">{</span><span class="n">you_delimiter</span><span class="p">})</span>

<span class="c1"># schema = (src_id int64, dst_id int64, weight float, attributes string)</span>
<span class="n">gl</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">weightd</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">attr_type</span><span class="o">=</span><span class="p">{</span><span class="n">your_attr_types</span><span class="p">},</span> <span class="n">attr_delimiter</span><span class="o">=</span><span class="p">{</span><span class="n">you_delimiter</span><span class="p">})</span>

<span class="c1"># schema = (src_id int64, dst_id int64, weight float, label int32)</span>
<span class="n">gl</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">weighted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">labeled</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># schema = (src_id int64, dst_id int64, weight float, label int32, attributes string)</span>
<span class="n">gl</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">weighted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">labeled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">attr_type</span><span class="o">=</span><span class="p">{</span><span class="n">your_attr_types</span><span class="p">},</span> <span class="n">attr_delimiter</span><span class="o">=</span><span class="p">{</span><span class="n">you_delimiter</span><span class="p">})</span>

<span class="c1"># schema = (src_id int64, dst_id int64, label int32, attributes string)</span>
<span class="n">gl</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">labeled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">attr_type</span><span class="o">=</span><span class="p">{</span><span class="n">your_attr_types</span><span class="p">},</span> <span class="n">attr_delimiter</span><span class="o">=</span><span class="p">{</span><span class="n">you_delimiter</span><span class="p">})</span>
</pre></div>
</div>
<p>## 3.4 Example Assume a data source shown in table 1, 2 and 3.</p>
<p>Table 1: item vertex table</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 26%" />
<col style="width: 74%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>id</p></th>
<th class="head"><p>feature</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>10001</p></td>
<td><p>feature1:1:0.1</p></td>
</tr>
<tr class="row-odd"><td><p>10002</p></td>
<td><p>feature2:2:0.2</p></td>
</tr>
<tr class="row-even"><td><p>10003</p></td>
<td><p>feature3:3:0.3</p></td>
</tr>
</tbody>
</table>
<p>Table 2 user vertex table</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 21%" />
<col style="width: 79%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>id</p></th>
<th class="head"><p>feature</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>123</p></td>
<td><p>0.1:0.2:0.3</p></td>
</tr>
<tr class="row-odd"><td><p>124</p></td>
<td><p>0.4:0.5:0.6</p></td>
</tr>
<tr class="row-even"><td><p>125</p></td>
<td><p>0.7:0.8:0.9</p></td>
</tr>
</tbody>
</table>
<p>Table 3 user-item edge table</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>src_id</p></th>
<th class="head"><p>dst_id</p></th>
<th class="head"><p>weight</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>123</p></td>
<td><p>10001</p></td>
<td><p>0.1</p></td>
</tr>
<tr class="row-odd"><td><p>124</p></td>
<td><p>10001</p></td>
<td><p>0.2</p></td>
</tr>
<tr class="row-even"><td><p>124</p></td>
<td><p>10002</p></td>
<td><p>0.3</p></td>
</tr>
</tbody>
</table>
<p>Here, we construct
ʻitem_node_decoder<code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">item</span> <span class="pre">vertex</span> <span class="pre">table,</span> <span class="pre">ʻuser_node_decoder</span></code> for
user vertex table and ʻedge_decoder` for edge table with the following
code.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">graphlearn</span> <span class="k">as</span> <span class="nn">gl</span>

<span class="n">item_node_decoder</span> <span class="o">=</span> <span class="n">gl</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">attr_types</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="s2">&quot;float&quot;</span><span class="p">])</span>
<span class="n">user_node_decoder</span> <span class="o">=</span> <span class="n">gl</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">attr_types</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;float&quot;</span><span class="p">])</span>
<span class="n">edge_decoder</span> <span class="o">=</span> <span class="n">gl</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">weighted</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>After constructing the Decoder for each data source, we add the data
source to the graph and specify the corresponding Decoder. Please refer
to <a class="reference external" href="graph_object_en.md">graph_object</a> for details.</p>
</div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2023, DAMO Academy, Alibaba Inc..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          

            
              
                <dd><a href="../../../latest/index.html">latest</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../index.html">stable</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.17.0/index.html">v0.17.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.16.0/index.html">v0.16.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.15.0/index.html">v0.15.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.14.0/index.html">v0.14.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.13.0/index.html">v0.13.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.12.0/index.html">v0.12.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.11.0/index.html">v0.11.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.10.1/index.html">v0.10.1</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.10.0/index.html">v0.10.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.9.1/index.html">v0.9.1</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.9.0/index.html">v0.9.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.8.0/index.html">v0.8.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.7.0/index.html">v0.7.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.6.1/index.html">v0.6.1</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.6.0/index.html">v0.6.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.5.0/index.html">v0.5.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.4.1/index.html">v0.4.1</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.4.0/index.html">v0.4.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.3.0/index.html">v0.3.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.2.1/index.html">v0.2.1</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.2.0/index.html">v0.2.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.1.3/index.html">v0.1.3</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.1.2/index.html">v0.1.2</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.1.1/index.html">v0.1.1</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.1.0/index.html">v0.1.0</a></dd>
              
            

          
        
      </dl>
    </div>
  </div>

  <div class="rst-languages shift-up" role="note" aria-label="languages">
    <div class="rst-other-languages">
      <dl>
        <dt>Languages</dt>
        <dd><a href="../../index.html">en</a></dd>
        <dd><a href="../../zh/index.html">zh_CN</a></dd>
      </dl>

      <hr />
      <small>
        <span>Hosted by <a href="https://pages.github.com/">Github Pages</a>.</span>
      </small>
    </div>
  </div>


</body>
</html>