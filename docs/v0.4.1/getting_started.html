

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Getting Started &mdash; GraphScope  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tutorials" href="tutorials.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> GraphScope
          

          
          </a>

          
            
            
              <div class="version">
                v0.4.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
      
      
        
          
        
      
      
        <p><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#example-node-clustering-on-citation-network">Example: Node clustering on Citation Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="#launching-session">Launching Session</a></li>
<li class="toctree-l2"><a class="reference internal" href="#loading-graph">Loading Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="#interactive-query">Interactive Query</a></li>
<li class="toctree-l2"><a class="reference internal" href="#graph-analytics">Graph Analytics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#graph-neural-networks-gnns">Graph Neural Networks (GNNs)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#closing-session">Closing Session</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="loading_graph.html">Loading Graphs</a></li>
<li class="toctree-l1"><a class="reference internal" href="graph_transformation.html">Graph Transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="interactive_engine.html">GraphScope Interactive Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="analytics_engine.html">GraphScope Analytical Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="learning_engine.html">GraphScope Learning Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer_guide.html">Developer Guide</a></li>
</ul>
<p><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="reference/python_index.html">Python API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference/analytical_engine_index.html">Analytical Engine API Reference</a></li>
</ul>

      
    
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">GraphScope</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Getting Started</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/getting_started.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="getting-started">
<h1>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<p><cite>graphscope</cite> is the Python client for GraphScope,
a one-stop graph computation system to process interactive queries,
analytical jobs and graph learning. It featured with ease-of-use, high-performance and
the scalability to evaluate graph computations over extremely large graphs.</p>
<p>This guide takes a walk-through for the <cite>graphscope</cite>.
We use a concrete example to illustrate how GraphScope
can be used by data scientists to effectively analyze large graphs.</p>
<section id="example-node-clustering-on-citation-network">
<h2>Example: Node clustering on Citation Network<a class="headerlink" href="#example-node-clustering-on-citation-network" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://ogb.stanford.edu/docs/nodeprop/#ogbn-mag">ogbn-mag</a> is a
heterogeneous network composed of a subset of the Microsoft
Academic Graph. It contains 4 types of entities(i.e., papers, authors, institutions, and fields of study),
as well as four types of directed relations connecting two entities.</p>
<p>Given the heterogeneous ogbn-mag data,
the prediction task is to predict the classification of each paper.
Node clustering can group papers sharing the similar topics together,
which identifies cooperations and trends in scientific groups.
We apply the attribute and structural information to cluster
similar papers together. In the graph, each paper node contains
a 128-dimensional word2vec vector representing its content,
which is obtained by averaging the embeddings of words in
its title and abstract. The embeddings of individual words
are pre-trained. The structural information is computed on-the-fly.</p>
<a class="reference internal image-reference" href="_images/how-it-works.png"><img alt="How it works." class="align-center" src="_images/how-it-works.png" style="width: 600px;" /></a>
<p>The figure shows the flow of execution when a client Python program is executed..</p>
<p>Step 1. Create a session or workspace in GraphScope.
Step 2. Define schema and load the graph.
Step 3. Query graph data.
Step 4. Run graph algorithms.
Step 5. Run graph-based machine learing tasks.
Step 6. Close the session.</p>
</section>
<section id="launching-session">
<h2>Launching Session<a class="headerlink" href="#launching-session" title="Permalink to this headline">¶</a></h2>
<p>To use GraphScope, we need to establish a <a class="reference internal" href="reference/session.html#session"><span class="std std-ref">Session</span></a> in a python interpreter.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">graphscope</span>

<span class="c1"># assume we mount `~/test_data` to `/testingdata` in pods.</span>
<span class="n">k8s_volumes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;hostPath&quot;</span><span class="p">,</span>
        <span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~/test_data/&quot;</span><span class="p">),</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Directory&quot;</span>
        <span class="p">},</span>
        <span class="s2">&quot;mounts&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;mountPath&quot;</span><span class="p">:</span> <span class="s2">&quot;/testingdata&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">sess</span> <span class="o">=</span> <span class="n">graphscope</span><span class="o">.</span><span class="n">session</span><span class="p">(</span><span class="n">k8s_volumes</span><span class="o">=</span><span class="n">k8s_volumes</span><span class="p">)</span>
</pre></div>
</div>
<p>For macOS, the session needs to establish with the LoadBalancer service type (which is NodePort by default).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sess</span> <span class="o">=</span> <span class="n">graphscope</span><span class="o">.</span><span class="n">session</span><span class="p">(</span><span class="n">k8s_volumes</span><span class="o">=</span><span class="n">k8s_volumes</span><span class="p">,</span> <span class="n">k8s_service_type</span><span class="o">=</span><span class="s2">&quot;LoadBalancer&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>A <a class="reference internal" href="reference/session.html#session"><span class="std std-ref">Session</span></a> tries to launch a coordinator,
which is the entry for the back-end engines.
The coordinator manages a cluster of resources (k8s pods),
and the interactive/analytical/learning engines ran on them.
For each pod in the cluster,
there is a vineyard instance at service for distributed data in memory.</p>
</section>
<section id="loading-graph">
<h2>Loading Graph<a class="headerlink" href="#loading-graph" title="Permalink to this headline">¶</a></h2>
<p>GraphScope models graph data as property graph,
in which the edges/vertices are labeled and have many properties.
Taking ogbn-mag as example, the figure below shows the model of the property graph.</p>
<a class="reference internal image-reference" href="_images/sample_pg.png"><img alt="a sample property graph." class="align-center" src="_images/sample_pg.png" style="width: 600px;" /></a>
<p>This graph has fours kinds of vertices, labeled as Paper, Author,
Institution and Field_of_study.
There are four kinds of edges connecting them,
each kind of edges has a label and specifies the vertex labels
for its two ends. For example, Cites edges connect two vertices labeled Paper.
Another example is Writes, it requires the source vertex is
labeled Author and the destination is a Paper vertex.
All the vertices and edges may have properties. e.g.,
Paper vertices have properties like features, publish year, subject label, etc.</p>
<p>To load this graph to GraphScope, one may use the code below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">g</span><span class="p">()</span>
<span class="n">g</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">g</span><span class="o">.</span><span class="n">add_vertices</span><span class="p">(</span><span class="s2">&quot;paper.csv&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;paper&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_vertices</span><span class="p">(</span><span class="s2">&quot;author.csv&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;author&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_vertices</span><span class="p">(</span><span class="s2">&quot;institution.csv&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;institution&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_vertices</span><span class="p">(</span><span class="s2">&quot;field_of_study.csv&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;field_of_study&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_edges</span><span class="p">(</span>
        <span class="s2">&quot;author_affiliated_with_institution.csv&quot;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;affiliated&quot;</span><span class="p">,</span>
        <span class="n">src_label</span><span class="o">=</span><span class="s2">&quot;author&quot;</span><span class="p">,</span>
        <span class="n">dst_label</span><span class="o">=</span><span class="s2">&quot;institution&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">add_edges</span><span class="p">(</span>
        <span class="s2">&quot;paper_has_topic_field_of_study.csv&quot;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;hasTopic&quot;</span><span class="p">,</span>
        <span class="n">src_label</span><span class="o">=</span><span class="s2">&quot;paper&quot;</span><span class="p">,</span>
        <span class="n">dst_label</span><span class="o">=</span><span class="s2">&quot;field_of_study&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">add_edges</span><span class="p">(</span>
        <span class="s2">&quot;paper_cites_paper.csv&quot;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;cites&quot;</span><span class="p">,</span>
        <span class="n">src_label</span><span class="o">=</span><span class="s2">&quot;paper&quot;</span><span class="p">,</span>
        <span class="n">dst_label</span><span class="o">=</span><span class="s2">&quot;paper&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">add_edges</span><span class="p">(</span>
        <span class="s2">&quot;author_writes_paper.csv&quot;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;writes&quot;</span><span class="p">,</span>
        <span class="n">src_label</span><span class="o">=</span><span class="s2">&quot;author&quot;</span><span class="p">,</span>
        <span class="n">dst_label</span><span class="o">=</span><span class="s2">&quot;paper&quot;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Alternatively, we provide a function to load this graph for convenience.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">graphscope.dataset.ogbn_mag</span> <span class="kn">import</span> <span class="n">load_ogbn_mag</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">load_ogbn_mag</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="s2">&quot;/testingdata/ogbn_mag_small/&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Here, the <code class="docutils literal notranslate"><span class="pre">g</span></code> is loaded in parallel via vineyard and stored
in vineyard instances in the cluster managed by the session.
See more details in <a class="reference internal" href="loading_graph.html#loading-graphs"><span class="std std-ref">Loading Graphs</span></a></p>
</section>
<section id="interactive-query">
<h2>Interactive Query<a class="headerlink" href="#interactive-query" title="Permalink to this headline">¶</a></h2>
<p>Understanding diverse graph data is an essential prerequisite to effective analysis,
and therefore it is very common for users to directly explore,
examine, and present graph data in an interactive environment
in order to locate specific information in time.
GraphScope adopts a high-level language called Gremlin
for graph traversal, and provides efficient execution at scale.</p>
<p>In this example, we use graph queries to find citation counts
for a particular author, and to derive a subgraph by
extracting publications in specific time out of the entire graph.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># get the entrypoint for submitting Gremlin queries on graph g.</span>
<span class="n">interactive</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">gremlin</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

<span class="c1"># check the total node_num and edge_num</span>
<span class="n">node_num</span> <span class="o">=</span> <span class="n">interactive</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;g.V().count()&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
<span class="n">edge_num</span> <span class="o">=</span> <span class="n">interactive</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;g.E().count()&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>

<span class="c1"># count the number of papers two authors (with id 2 and 4307) have co-authored.</span>
<span class="n">papers</span> <span class="o">=</span> <span class="n">interactive</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;g.V().has(&#39;author&#39;, &#39;id&#39;, 2).out(&#39;writes&#39;)</span><span class="se">\</span>
<span class="s2">                .where(__.in(&#39;writes&#39;).has(&#39;id&#39;, 4307)).count()&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="graph-analytics">
<h2>Graph Analytics<a class="headerlink" href="#graph-analytics" title="Permalink to this headline">¶</a></h2>
<p>Graph analytics is widely used in real world. Many algorithms,
like community detection, paths and connectivity, centrality are proven to be
very useful in various businesses. GraphScope ships
with a set of built-in algorithms, enables users easily analysis their graph data.</p>
<p>Please note that many algorithms may only work on homogeneous graphs.
To evaluate these algorithms over a property graph,
you may want to project the property graph to a simple graph at first.</p>
<p>Continue our example, we run k-core decomposition and triangle counting
to generate the structural features of each paper node.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># exact a subgraph of publication within a time range</span>
<span class="n">sub_graph</span> <span class="o">=</span> <span class="n">interactive</span><span class="o">.</span><span class="n">subgraph</span><span class="p">(</span><span class="s2">&quot;g.V().has(&#39;year&#39;, inside(2014, 2020)).outE(&#39;cites&#39;)&quot;</span><span class="p">)</span>

<span class="c1"># project the projected graph to simple graph.</span>
<span class="n">simple_g</span> <span class="o">=</span> <span class="n">sub_graph</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">vertices</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;paper&quot;</span><span class="p">:</span> <span class="p">[]},</span> <span class="n">edges</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;cites&quot;</span><span class="p">:</span> <span class="p">[]})</span>

<span class="n">ret1</span> <span class="o">=</span> <span class="n">graphscope</span><span class="o">.</span><span class="n">kcore</span><span class="p">(</span><span class="n">simple_g</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ret2</span> <span class="o">=</span> <span class="n">graphscope</span><span class="o">.</span><span class="n">triangle</span><span class="p">(</span><span class="n">simple_g</span><span class="p">)</span>

<span class="c1"># add the results as new columns to the citation graph</span>
<span class="n">sub_graph</span> <span class="o">=</span> <span class="n">sub_graph</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">ret1</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;kcore&quot;</span><span class="p">:</span> <span class="s2">&quot;r&quot;</span><span class="p">})</span>
<span class="n">sub_graph</span> <span class="o">=</span> <span class="n">sub_graph</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">ret2</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;tc&quot;</span><span class="p">:</span> <span class="s2">&quot;r&quot;</span><span class="p">})</span>
</pre></div>
</div>
<p>In addition, users can write their own algorithms in GraphScope.
Currently, GraphScope support users to write their own algorithms in
PIE model and Pregel model.</p>
</section>
<section id="graph-neural-networks-gnns">
<h2>Graph Neural Networks (GNNs)<a class="headerlink" href="#graph-neural-networks-gnns" title="Permalink to this headline">¶</a></h2>
<p>Graph neural networks (GNNs) combines superiority of
both graph analytics and machine learning.
GNN algorithms can compress both structural and attribute information
in a graph into low-dimensional embedding vectors on each node.
These embeddings can be further fed into downstream machine learning tasks.</p>
<p>In our example, we train a GCN model to classify the nodes (papers) into 349 categories,
each of which represents a venue (e.g. pre-print and conference).
To achieve this, first we launch a learning engine and build
a graph with features following the last step.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># define the features for learning</span>
<span class="n">paper_features</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">128</span><span class="p">):</span>
    <span class="n">paper_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;feat_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<span class="n">paper_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;kcore&quot;</span><span class="p">)</span>
<span class="n">paper_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;tc&quot;</span><span class="p">)</span>

<span class="c1"># launch a learning engine.</span>
<span class="n">lg</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">learning</span><span class="p">(</span><span class="n">sub_graph</span><span class="p">,</span> <span class="n">nodes</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;paper&quot;</span><span class="p">,</span> <span class="n">paper_features</span><span class="p">)],</span>
                   <span class="n">edges</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;paper&quot;</span><span class="p">,</span> <span class="s2">&quot;cites&quot;</span><span class="p">,</span> <span class="s2">&quot;paper&quot;</span><span class="p">)],</span>
                   <span class="n">gen_labels</span><span class="o">=</span><span class="p">[</span>
                        <span class="p">(</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="s2">&quot;paper&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">75</span><span class="p">)),</span>
                        <span class="p">(</span><span class="s2">&quot;val&quot;</span><span class="p">,</span> <span class="s2">&quot;paper&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="p">(</span><span class="mi">75</span><span class="p">,</span> <span class="mi">85</span><span class="p">)),</span>
                        <span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="s2">&quot;paper&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="p">(</span><span class="mi">85</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
                  <span class="p">])</span>
</pre></div>
</div>
<p>Then we define the training and testing process, and run it.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">graphscope.learning.examples</span> <span class="kn">import</span> <span class="n">GCN</span>
<span class="kn">from</span> <span class="nn">graphscope.learning.graphlearn.python.model.tf.trainer</span> <span class="kn">import</span> <span class="n">LocalTFTrainer</span>
<span class="kn">from</span> <span class="nn">graphscope.learning.graphlearn.python.model.tf.optimizer</span> <span class="kn">import</span> <span class="n">get_tf_optimizer</span>

<span class="c1"># supervised GCN.</span>

<span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">model_fn</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">GCN</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span>
                   <span class="n">config</span><span class="p">[</span><span class="s2">&quot;class_num&quot;</span><span class="p">],</span>
                   <span class="n">config</span><span class="p">[</span><span class="s2">&quot;features_num&quot;</span><span class="p">],</span>
                   <span class="n">config</span><span class="p">[</span><span class="s2">&quot;batch_size&quot;</span><span class="p">],</span>
                   <span class="n">val_batch_size</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;val_batch_size&quot;</span><span class="p">],</span>
                   <span class="n">test_batch_size</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;test_batch_size&quot;</span><span class="p">],</span>
                   <span class="n">categorical_attrs_desc</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;categorical_attrs_desc&quot;</span><span class="p">],</span>
                   <span class="n">hidden_dim</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;hidden_dim&quot;</span><span class="p">],</span>
                   <span class="n">in_drop_rate</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;in_drop_rate&quot;</span><span class="p">],</span>
                   <span class="n">neighs_num</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;neighs_num&quot;</span><span class="p">],</span>
                   <span class="n">hops_num</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;hops_num&quot;</span><span class="p">],</span>
                   <span class="n">node_type</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;node_type&quot;</span><span class="p">],</span>
                   <span class="n">edge_type</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;edge_type&quot;</span><span class="p">],</span>
                   <span class="n">full_graph_mode</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;full_graph_mode&quot;</span><span class="p">])</span>

    <span class="n">trainer</span> <span class="o">=</span> <span class="n">LocalTFTrainer</span><span class="p">(</span><span class="n">model_fn</span><span class="p">,</span>
                             <span class="n">epoch</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;epoch&quot;</span><span class="p">],</span>
                             <span class="n">optimizer</span><span class="o">=</span><span class="n">gl</span><span class="o">.</span><span class="n">get_tf_optimizer</span><span class="p">(</span>
                             <span class="n">config</span><span class="p">[</span><span class="s2">&quot;learning_algo&quot;</span><span class="p">],</span>
                             <span class="n">config</span><span class="p">[</span><span class="s2">&quot;learning_rate&quot;</span><span class="p">],</span>
                             <span class="n">config</span><span class="p">[</span><span class="s2">&quot;weight_decay&quot;</span><span class="p">]))</span>
    <span class="n">trainer</span><span class="o">.</span><span class="n">train_and_evaluate</span><span class="p">()</span>

<span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;class_num&quot;</span><span class="p">:</span> <span class="mi">349</span><span class="p">,</span> <span class="c1"># output dimension</span>
          <span class="s2">&quot;features_num&quot;</span><span class="p">:</span> <span class="mi">130</span><span class="p">,</span> <span class="c1"># 128 dimension + kcore + triangle count</span>
          <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
          <span class="s2">&quot;val_batch_size&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
          <span class="s2">&quot;test_batch_size&quot;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span>
          <span class="s2">&quot;categorical_attrs_desc&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
          <span class="s2">&quot;hidden_dim&quot;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span>
          <span class="s2">&quot;in_drop_rate&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
          <span class="s2">&quot;hops_num&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
          <span class="s2">&quot;neighs_num&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
          <span class="s2">&quot;full_graph_mode&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
          <span class="s2">&quot;agg_type&quot;</span><span class="p">:</span> <span class="s2">&quot;gcn&quot;</span><span class="p">,</span>  <span class="c1"># mean, sum</span>
          <span class="s2">&quot;learning_algo&quot;</span><span class="p">:</span> <span class="s2">&quot;adam&quot;</span><span class="p">,</span>
          <span class="s2">&quot;learning_rate&quot;</span><span class="p">:</span> <span class="mf">0.0005</span><span class="p">,</span>
          <span class="s2">&quot;weight_decay&quot;</span><span class="p">:</span> <span class="mf">0.000005</span><span class="p">,</span>
          <span class="s2">&quot;epoch&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
          <span class="s2">&quot;node_type&quot;</span><span class="p">:</span> <span class="s2">&quot;paper&quot;</span><span class="p">,</span>
          <span class="s2">&quot;edge_type&quot;</span><span class="p">:</span> <span class="s2">&quot;cites&quot;</span><span class="p">}</span>

<span class="n">train</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">lg</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="closing-session">
<h2>Closing Session<a class="headerlink" href="#closing-session" title="Permalink to this headline">¶</a></h2>
<p>At last, we close the session after processing all graph tasks.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sess</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>This operation will notify the backend engines and vineyard
to safely unload graphs and their applications.
Then, the coordinator will dealloc all the applied resources in the k8s cluster.</p>
</section>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tutorials.html" class="btn btn-neutral float-right" title="Tutorials" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="installation.html" class="btn btn-neutral" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020-2023, Damo Academy, Alibaba Inc.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: v0.4.1
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          

            
              
                <dd><a href="../latest/index.html">latest</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../index.html">stable</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../v0.4.1/index.html">v0.4.1</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../v0.4.0/index.html">v0.4.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../v0.3.0/index.html">v0.3.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../v0.2.1/index.html">v0.2.1</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../v0.2.0/index.html">v0.2.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../v0.1.3/index.html">v0.1.3</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../v0.1.2/index.html">v0.1.2</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../v0.1.1/index.html">v0.1.1</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../v0.1.0/index.html">v0.1.0</a></dd>
              
            

          
        
      </dl>
    </div>
  </div>

  <div class="rst-languages shift-up" role="note" aria-label="languages">
    <div class="rst-other-languages">
      <dl>
        <dt>Languages</dt>
        <dd><a href="index.html">en</a></dd>
        <dd><a href="zh/index.html">zh_CN</a></dd>
      </dl>

      <hr />
      <small>
        <span>Hosted by <a href="https://pages.github.com/">Github Pages</a>.</span>
      </small>
    </div>
  </div>


</body>
</html>