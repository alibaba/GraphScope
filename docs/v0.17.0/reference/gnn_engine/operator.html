<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Defining Your Own Operator &mdash; GraphScope  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

 

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4TMYCGJ0X2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-4TMYCGJ0X2');
</script>

<script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?da649ade2298891886e31922dfc8870f";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script>


</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> GraphScope
          </a>
              <div class="version">
                v0.17.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div>
  <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    
      
      
        
          
        
      
      
        <p class="caption"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deployment.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../loading_graph.html">Loading Graphs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../graph_transformation.html">Graph Transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analytics_engine.html">GraphScope Analytical Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../interactive_engine.html">GraphScope Interactive Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../learning_engine.html">GraphScope Learning Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../persistent_graph_store.html">Persistent Graph Store</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../frequently_asked_questions.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer_guide.html">Developer Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../python_index.html">Python API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analytical_engine_index.html">Analytical Engine API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gae_java/index.html">Analytical Engine Java API Reference</a></li>
</ul>

      
    
  </div>

      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">GraphScope</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Defining Your Own Operator</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/alibaba/graphscope/edit/main/docs/reference/gnn_engine/operator.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="defining-your-own-operator">
<h1>Defining Your Own Operator<a class="headerlink" href="#defining-your-own-operator" title="Permalink to this headline"></a></h1>
<p>In <strong>GL</strong>, an <strong>operator</strong> is a basic executable unit. The system
function is represented by the operators. For example, a graph sampler
is a kind of operator. Operators can be <strong>extended</strong> according to
requirements. Usually, we just focus on the local implementation when
customizing an operator. The system framework will help run it
distributedly.</p>
</div>
<div class="section" id="programming-interface">
<h1>Programming Interface<a class="headerlink" href="#programming-interface" title="Permalink to this headline"></a></h1>
<p>To customize an <strong>operator</strong>, class
<a class="reference external" href="../graphlearn/core/operator/operator.h">Operator</a> should be
inherited. And then override the following virtual function.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">virtual</span><span class="w"> </span><span class="n">Status</span><span class="w"> </span><span class="nf">Process</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">OpRequest</span><span class="o">*</span><span class="w"> </span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">OpResponse</span><span class="o">*</span><span class="w"> </span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>If you just want to implement a kind of neighborhood <strong>sampler</strong>,
inheriting from class
<a class="reference external" href="../graphlearn/core/operator/sampler/sampler.h">Sampler</a> may be an
easy way.</p>
<p>The context of each <strong>operator</strong> is
<a class="reference external" href="../graphlearn/include/op_request.h">OpRequest</a> and
<a class="reference external" href="../graphlearn/include/op_request.h">OpResponse</a>. Two kinds of data
map are contained in the context. <code class="docutils literal notranslate"><span class="pre">params_</span></code> is the description of the
context. It is usually made up of some <strong>scalar</strong>
<a class="reference external" href="../graphlearn/include/tensor.h">Tensor</a>, such as “node type” and
“sampling strategy”. <code class="docutils literal notranslate"><span class="pre">tensors_</span></code> is the body of the context. It usually
takes data <strong>vectors</strong>. For example, sampling one-hop neighbors for a
batch of node ids, in which the ids should be put in <code class="docutils literal notranslate"><span class="pre">tensors_</span></code>.</p>
<p>In distributed mode, the graph data will be partitioned into serveral
servers. When a server receives an operator execution request, part of
the request may be <strong>redirected</strong> to other servers. The data that needs
to be partitioned should be placed into <code class="docutils literal notranslate"><span class="pre">tensors_</span></code>, and rewrite the
<strong>Partition()</strong> function.</p>
<p>Till now, we have abstracted the partition rules for all the existed
operators. You can just use the
<a class="reference external" href="../graphlearn/core/partition/partitioner.h">Partitioner</a> in most
cases.</p>
</div>
<div class="section" id="distributed-runtime-design">
<h1>Distributed Runtime Design<a class="headerlink" href="#distributed-runtime-design" title="Permalink to this headline"></a></h1>
<p><strong>GL</strong> follows the principle that the <strong>computation happens where the
data is placed</strong>. In distributed mode, all severs can communicate with
each other and know the distribution of the partitioned data. When an
operator request received, the server will push the partitioned requests
to the right servers instead of pulling the data back. Some operators
may return responses that need to be <strong>stitched</strong> together, and some may
just compute in place of the corresponding raw data.</p>
<p>As above, we propose the <strong>Partition-Stitch</strong> computing pattern for
operators. Developers just need care about the next three functions
<strong>Partition()</strong>, <strong>Process()</strong>, <strong>Stitch()</strong>.</p>
<div class="figure align-default" id="id1">
<img alt="op" src="reference/gnn_engine/images/operator_runtime.png" />
<p class="caption"><span class="caption-text">op</span><a class="headerlink" href="#id1" title="Permalink to this image"></a></p>
</div>
</div>
<div class="section" id="implement-a-new-operator">
<h1>Implement a New Operator<a class="headerlink" href="#implement-a-new-operator" title="Permalink to this headline"></a></h1>
<div class="section" id="clone-source-code">
<h2>Clone source code<a class="headerlink" href="#clone-source-code" title="Permalink to this headline"></a></h2>
<p>To <strong>implement</strong> an operator, you should clone the source code first.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/alibaba/graph-learn.git
git submodule update --init
</pre></div>
</div>
<p>Refer to <a class="reference external" href="install.md#build-from-source">building from source</a> to
build pass.</p>
</div>
<div class="section" id="implement-your-operator-class">
<h2>Implement your operator class<a class="headerlink" href="#implement-your-operator-class" title="Permalink to this headline"></a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">MyOperator</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Operator</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="w">  </span><span class="n">Status</span><span class="w"> </span><span class="n">Process</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">OpRequest</span><span class="o">*</span><span class="w"> </span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">OpResponse</span><span class="o">*</span><span class="w"> </span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">//TODO</span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</pre></div>
</div>
<p>If you need to rewrite the <strong>Partition()</strong> and <strong>Stitch()</strong>, you should
customize request and response class, which inherits from <strong>OpRequest</strong>
and <strong>OpResponse</strong>.</p>
</div>
<div class="section" id="register-operator">
<h2>Register Operator<a class="headerlink" href="#register-operator" title="Permalink to this headline"></a></h2>
<p>Each operator has a <strong>unique name</strong>. Register the operator with its name
and class name.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">REGISTER_OPERATOR</span><span class="p">(</span><span class="s">&quot;OpName&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">MyOperator</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Please make sure that the registered name should be the same with
<strong>OpRequest.Name()</strong>. Refer to an existed operator, such as
<a class="reference external" href="../graphlearn/core/operator/sampler/random_sampler.cc">RandomSampler</a>
for details.</p>
</div>
<div class="section" id="compile">
<h2>Compile<a class="headerlink" href="#compile" title="Permalink to this headline"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">graph</span><span class="o">-</span><span class="n">learn</span>
<span class="n">make</span> <span class="n">clean</span>
<span class="n">make</span> <span class="n">test</span>
</pre></div>
</div>
<p>Usually, writting a C++ test is the fast way to check errors. After
that, you can make the python package and install it.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">python</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">dist</span><span class="o">/</span><span class="n">your_wheel_name</span><span class="o">.</span><span class="n">whl</span> <span class="o">-</span><span class="n">U</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="how-to-use-an-operator">
<h1>How to Use an Operator<a class="headerlink" href="#how-to-use-an-operator" title="Permalink to this headline"></a></h1>
<p>For example, if a new sampler named <strong>xxxSampler</strong>, you can call it like
this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">g</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">by</span><span class="p">(</span><span class="s2">&quot;xxx&quot;</span><span class="p">)</span><span class="o">...</span>
</pre></div>
</div>
<p>More information about <strong>API</strong> refer to <a class="reference external" href="query.md">this</a>.</p>
<p><a class="reference external" href="../README.md">Home</a></p>
</div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2023, DAMO Academy, Alibaba Inc..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: v0.17.0
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          

            
              
                <dd><a href="../../../latest/index.html">latest</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../index.html">stable</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.17.0/index.html">v0.17.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.16.0/index.html">v0.16.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.15.0/index.html">v0.15.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.14.0/index.html">v0.14.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.13.0/index.html">v0.13.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.12.0/index.html">v0.12.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.11.0/index.html">v0.11.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.10.1/index.html">v0.10.1</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.10.0/index.html">v0.10.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.9.1/index.html">v0.9.1</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.9.0/index.html">v0.9.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.8.0/index.html">v0.8.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.7.0/index.html">v0.7.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.6.1/index.html">v0.6.1</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.6.0/index.html">v0.6.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.5.0/index.html">v0.5.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.4.1/index.html">v0.4.1</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.4.0/index.html">v0.4.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.3.0/index.html">v0.3.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.2.1/index.html">v0.2.1</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.2.0/index.html">v0.2.0</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.1.3/index.html">v0.1.3</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.1.2/index.html">v0.1.2</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.1.1/index.html">v0.1.1</a></dd>
              
            

          
        
          

            
              
                <dd><a href="../../../v0.1.0/index.html">v0.1.0</a></dd>
              
            

          
        
      </dl>
    </div>
  </div>

  <div class="rst-languages shift-up" role="note" aria-label="languages">
    <div class="rst-other-languages">
      <dl>
        <dt>Languages</dt>
        <dd><a href="../../index.html">en</a></dd>
        <dd><a href="../../zh/index.html">zh_CN</a></dd>
      </dl>

      <hr />
      <small>
        <span>Hosted by <a href="https://pages.github.com/">Github Pages</a>.</span>
      </small>
    </div>
  </div>


</body>
</html>