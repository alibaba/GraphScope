g.V().hasLabel('PERSON').has('id',$personId).both('KNOWS').union(identity(), both('KNOWS')).dedup().filter(__.out('ISLOCATEDIN').has('name',neq('$countryXName').and(neq('$countryYName')))).as('friend').filter(__.in('HASCREATOR').has('creationDate',inside($startDate,$endDate)).out('ISLOCATEDIN').has('name', eq('$countryXName').or(eq('$countryYName'))).values("name").dedup().count().unfold().is(2)).group().by().by(__.in('HASCREATOR').has('creationDate',inside($startDate,$endDate)).out('ISLOCATEDIN').has('name', '$countryXName').count()).unfold().order().by(select(values), desc).by(select(keys).values('id')).limit(20)