g.V().hasLabel('PERSON').has('id',$personId).both('KNOWS').union(identity(), both('KNOWS')).dedup().filter(__.out('ISLOCATEDIN').has('name',without('$countryXName','$countryYName'))).as('friend').filter(__.in('HASCREATOR').has('creationDate',inside($startDate,$endDate)).out('ISLOCATEDIN').values('name').fold().filter(Lists.containsAll(Lists.of('$countryXName', '$countryYName')))).group().by().by(__.in('HASCREATOR').has('creationDate',inside($startDate,$endDate)).out('ISLOCATEDIN').has('name', '$countryXName').count()).unfold().order().by(select(values), decr).by(select(keys).values('id')).limit(20)